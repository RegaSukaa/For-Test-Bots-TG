<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GaGBot - Фермерская игра</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Roboto+Slab:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        :root {
            --primary: #4CAF50;
            --primary-dark: #388E3C;
            --secondary: #FFC107;
            --secondary-dark: #FFA000;
            --background: #f5f9f6;
            --surface: #FFFFFF;
            --text-primary: #2c3e50;
            --text-secondary: #7f8c8d;
            --error: #e74c3c;
            --success: #27ae60;
            --warning: #f39c12;
            --border-radius: 16px;
            --shadow: 0 6px 15px rgba(0,0,0,0.08);
            --transition: all 0.3s ease;
        }

        body {
            background: linear-gradient(135deg, #e0f7fa, #f1f8e9);
            color: var(--text-primary);
            padding: 16px;
            max-width: 100%;
            overflow-x: hidden;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .container {
            max-width: 480px;
            margin: 0 auto;
            width: 100%;
        }

        .header-title {
            text-align: center;
            padding: 20px 0;
            margin-bottom: 10px;
            position: relative;
        }

        .header-title h1 {
            font-family: 'Roboto Slab', serif;
            font-size: 2.5rem;
            color: var(--primary-dark);
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            letter-spacing: 1px;
        }

        .header-title .subtitle {
            font-size: 1rem;
            color: var(--text-secondary);
            margin-top: 5px;
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--surface);
            padding: 16px 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }

        .game-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
        }

        .balance-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .balance {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
            font-family: 'Roboto Slab', serif;
        }

        .coins-icon {
            color: var(--secondary);
            font-size: 1.8rem;
            animation: shine 2s infinite;
        }

        .action-buttons {
            display: flex;
            gap: 12px;
        }

        .btn {
            padding: 12px 18px;
            border: none;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition);
            font-size: 0.95rem;
            box-shadow: var(--shadow);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(76, 175, 80, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--secondary), var(--secondary-dark));
            color: var(--text-primary);
        }

        .btn-secondary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 193, 7, 0.3);
        }

        .btn-neutral {
            background-color: var(--surface);
            color: var(--text-primary);
            border: 1px solid #e0e0e0;
        }

        .btn-neutral:hover {
            background-color: #f5f5f5;
            transform: translateY(-3px);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: var(--shadow) !important;
        }

        .section-title {
            font-size: 1.3rem;
            margin-bottom: 16px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--primary);
        }

        .farm-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        .plot {
            aspect-ratio: 1/1;
            background-color: #f1f8e9;
            border-radius: var(--border-radius);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
            cursor: pointer;
            border: 2px solid #c5e1a5;
        }

        .plot.empty {
            background-color: #e8f5e9;
            border: 2px dashed var(--primary);
        }

        .plot.growing {
            background-color: #fffde7;
            border-color: #ffd54f;
        }

        .plot.ready {
            background-color: #fff3e0;
            border-color: #ffb74d;
            animation: pulse 1.5s infinite;
        }

        .plot-content {
            text-align: center;
            padding: 10px;
            width: 100%;
            z-index: 2;
        }

        .plant-icon {
            font-size: 2.8rem;
            margin-bottom: 5px;
            transition: transform 0.5s ease;
        }

        .plot.ready .plant-icon {
            animation: bounce 0.8s infinite alternate;
        }

        .plant-name {
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 6px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .progress-container {
            width: 85%;
            height: 8px;
            background-color: #e0e0e0;
            border-radius: 5px;
            overflow: hidden;
            margin-top: 8px;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 5px;
            transition: width 0.5s ease;
        }

        .time-remaining {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-top: 5px;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .action-panel {
            background-color: var(--surface);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }

        .harvest-all-btn {
            width: 100%;
            padding: 16px;
            font-size: 1.2rem;
            font-weight: 700;
        }

        .language-switcher {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: auto;
            padding: 16px 0;
        }

        .lang-btn {
            background: none;
            border: none;
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 10px 20px;
            border-radius: 50px;
            transition: var(--transition);
            border: 2px solid #e0e0e0;
        }

        .lang-btn.active {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border-color: var(--primary);
        }

        /* Модальные окна */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background-color: var(--surface);
            width: 90%;
            max-width: 450px;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.25);
            transform: translateY(30px);
            transition: transform 0.4s ease;
            max-height: 85vh;
            overflow-y: auto;
        }

        .modal.active .modal-content {
            transform: translateY(0);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--primary);
        }

        .modal-title {
            font-size: 1.6rem;
            font-weight: 700;
            color: var(--primary-dark);
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.8rem;
            cursor: pointer;
            color: var(--text-secondary);
            transition: var(--transition);
        }

        .close-btn:hover {
            color: var(--primary);
            transform: rotate(90deg);
        }

        /* Стили для магазина */
        .shop-items {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 18px;
        }

        .shop-item {
            background: linear-gradient(to bottom, #ffffff, #f5f5f5);
            border-radius: var(--border-radius);
            padding: 18px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            transition: var(--transition);
            border: 1px solid #e0e0e0;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .shop-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(0,0,0,0.15);
        }

        .shop-item-header {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .shop-item-icon {
            font-size: 2.5rem;
            min-width: 50px;
            text-align: center;
        }

        .shop-item-name {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--primary-dark);
            word-break: break-word;
            flex: 1;
        }

        .shop-item-price {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 1rem;
            font-weight: 600;
        }

        .shop-item-stats {
            font-size: 0.85rem;
            color: var(--text-secondary);
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px;
            margin-top: 5px;
        }

        .buy-btn {
            margin-top: 10px;
            width: 100%;
        }

        .availability {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: var(--secondary);
            color: var(--text-primary);
            font-weight: 700;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.85rem;
        }

        /* Стили для инвентаря */
        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .inventory-item {
            background: linear-gradient(to bottom, #ffffff, #f5f5f5);
            border-radius: var(--border-radius);
            padding: 18px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            border: 1px solid #e0e0e0;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .inventory-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .inventory-item-icon {
            font-size: 2.5rem;
        }

        .inventory-item-name {
            font-weight: 600;
            font-size: 1rem;
            text-align: center;
            min-height: 40px;
            display: flex;
            align-items: center;
        }

        .inventory-item-quantity {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border-radius: 50px;
            padding: 4px 12px;
            font-size: 0.95rem;
            font-weight: 700;
            min-width: 35px;
        }

        .inventory-actions {
            display: flex;
            gap: 8px;
            margin-top: 10px;
            width: 100%;
        }

        .action-btn {
            flex: 1;
            padding: 8px;
            font-size: 0.85rem;
        }

        .inventory-fruits {
            width: 100%;
            margin-top: 10px;
            background: #e8f5e9;
            border-radius: 10px;
            padding: 10px;
            max-height: 150px;
            overflow-y: auto;
        }

        .fruit-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px dashed #c8e6c9;
            font-size: 0.9rem;
        }

        .fruit-item:last-child {
            border-bottom: none;
        }

        .fruit-weight {
            font-weight: 600;
            color: var(--primary-dark);
        }

        /* Стили для сбора урожая */
        .harvest-summary {
            margin-top: 20px;
            background-color: #e8f5e9;
            border-radius: var(--border-radius);
            padding: 15px;
            border-left: 4px solid var(--success);
        }

        .harvest-title {
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--success);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .harvest-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px dashed #c8e6c9;
        }

        .harvest-item:last-child {
            border-bottom: none;
        }

        /* Анимации */
        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 193, 7, 0.7); }
            70% { transform: scale(1.02); box-shadow: 0 0 0 10px rgba(255, 193, 7, 0); }
            100% { transform: scale(1); }
        }

        @keyframes bounce {
            0% { transform: translateY(0); }
            100% { transform: translateY(-10px); }
        }

        @keyframes shine {
            0% { text-shadow: 0 0 5px rgba(255, 215, 0, 0); }
            50% { text-shadow: 0 0 15px rgba(255, 215, 0, 0.8); }
            100% { text-shadow: 0 0 5px rgba(255, 215, 0, 0); }
        }

        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 15px 30px;
            border-radius: 50px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            z-index: 1001;
            animation: grow 0.4s ease, grow 0.4s ease reverse forwards 2.5s;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        @keyframes grow {
            0% { opacity: 0; top: 0; }
            100% { opacity: 1; top: 20px; }
        }

        .collect-animation {
            position: absolute;
            font-size: 2rem;
            animation: floatUp 1s ease-out forwards;
            z-index: 10;
            pointer-events: none;
        }

        @keyframes floatUp {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-100px); opacity: 0; }
        }

        /* Адаптивность */
        @media (max-width: 400px) {
            .farm-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .shop-items {
                grid-template-columns: 1fr;
            }
            
            .inventory-grid {
                grid-template-columns: 1fr;
            }

            .btn {
                padding: 10px 15px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Заголовок с названием бота -->
        <div class="header-title">
            <h1>GaG Farm</h1>
            <div class="subtitle" id="subtitle">Выращивай, собирай, продавай!</div>
        </div>

        <!-- Шапка с балансом и кнопками -->
        <div class="game-header">
            <div class="balance-container">
                <i class="fas fa-coins coins-icon"></i>
                <div class="balance" id="balance">20</div>
            </div>
            <div class="action-buttons">
                <button class="btn btn-secondary" id="harvestAllBtn">
                    <i class="fas fa-hand-holding-usd"></i>
                    <span id="harvestBtnText">Собрать всё</span>
                </button>
                <button class="btn btn-neutral" id="shopBtn">
                    <i class="fas fa-store"></i>
                </button>
                <button class="btn btn-neutral" id="inventoryBtn">
                    <i class="fas fa-shopping-bag"></i>
                </button>
            </div>
        </div>

        <!-- Секция грядок -->
        <div class="action-panel">
            <h2 class="section-title">
                <i class="fas fa-seedling"></i>
                <span id="farmTitle">Ваши грядки</span>
            </h2>
            <div class="farm-grid" id="farmGrid">
                <!-- Грядки будут генерироваться через JS -->
            </div>
        </div>

        <!-- Переключатель языка -->
        <div class="language-switcher">
            <button class="lang-btn active" data-lang="ru">Русский</button>
            <button class="lang-btn" data-lang="en">English</button>
        </div>
    </div>

    <!-- Модальное окно магазина -->
    <div class="modal" id="shopModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">
                    <i class="fas fa-store"></i>
                    <span id="shopTitle">Магазин семян</span>
                </h2>
                <button class="close-btn" id="closeShopModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="shop-items" id="shopItems">
                <!-- Товары магазина будут генерироваться через JS -->
            </div>
            <div class="shop-timer" style="margin-top: 20px; text-align: center; font-weight: 500; color: var(--text-secondary);">
                <i class="fas fa-sync-alt"></i> 
                <span id="shopTimer">Магазин обновится через: 5:00</span>
            </div>
        </div>
    </div>

    <!-- Модальное окно инвентаря -->
    <div class="modal" id="inventoryModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">
                    <i class="fas fa-shopping-bag"></i>
                    <span id="inventoryTitle">Ваш инвентарь</span>
                </h2>
                <button class="close-btn" id="closeInventoryModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="inventory-grid" id="inventoryGrid">
                <!-- Инвентарь будет генерироваться через JS -->
            </div>
        </div>
    </div>

    <!-- Модальное окно сбора урожая -->
    <div class="modal" id="harvestModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">
                    <i class="fas fa-hand-holding-usd"></i>
                    <span id="harvestTitle">Урожай собран!</span>
                </h2>
                <button class="close-btn" id="closeHarvestModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="harvest-summary" id="harvestSummary">
                <!-- Сводка по собранному урожаю -->
            </div>
        </div>
    </div>

    <script>
        // Игровые данные
        const gameData = {
            balance: 20,
            plots: Array(30).fill().map(() => ({ plant: null, progress: 0, fruits: [] })),
            inventory: {
                seeds: {},
                plants: {}
            },
            plants: {
                carrot: { 
                    name: { ru: "Морковь", en: "Carrot" }, 
                    icon: "🥕", 
                    seedPrice: 10, 
                    growthTime: 60, 
                    minWeight: 0.1, 
                    maxWeight: 0.3, 
                    pricePerKg: 60, // Увеличенная цена
                    fruitCount: 1,
                    repeatGrowth: false,
                    availabilityChance: 1
                },
                tomato: { 
                    name: { ru: "Помидор", en: "Tomato" }, 
                    icon: "🍅", 
                    seedPrice: 20, 
                    growthTime: 120, 
                    minWeight: 0.2, 
                    maxWeight: 0.5, 
                    pricePerKg: 90, // Увеличенная цена
                    fruitCount: 3,
                    repeatGrowth: true,
                    availabilityChance: 0.8
                },
                potato: { 
                    name: { ru: "Картофель", en: "Potato" }, 
                    icon: "🥔", 
                    seedPrice: 15, 
                    growthTime: 180, 
                    minWeight: 0.3, 
                    maxWeight: 0.7, 
                    pricePerKg: 45, // Увеличенная цена
                    fruitCount: 5,
                    repeatGrowth: false,
                    availabilityChance: 0.9
                },
                strawberry: { 
                    name: { ru: "Клубника", en: "Strawberry" }, 
                    icon: "🍓", 
                    seedPrice: 25, 
                    growthTime: 90, 
                    minWeight: 0.05, 
                    maxWeight: 0.1, 
                    pricePerKg: 120, // Увеличенная цена
                    fruitCount: 8,
                    repeatGrowth: true,
                    availabilityChance: 0.7
                },
                cucumber: { 
                    name: { ru: "Огурец", en: "Cucumber" }, 
                    icon: "🥒", 
                    seedPrice: 30, 
                    growthTime: 150, 
                    minWeight: 0.4, 
                    maxWeight: 0.8, 
                    pricePerKg: 52, // Увеличенная цена
                    fruitCount: 2,
                    repeatGrowth: true,
                    availabilityChance: 0.6
                },
                mango: { 
                    name: { ru: "Манго", en: "Mango" }, 
                    icon: "🥭", 
                    seedPrice: 150, 
                    growthTime: 300, 
                    minWeight: 0.5, 
                    maxWeight: 1.5, 
                    pricePerKg: 150, // Увеличенная цена
                    fruitCount: 1,
                    repeatGrowth: true,
                    availabilityChance: 0.4
                },
                grapes: { 
                    name: { ru: "Виноград", en: "Grapes" }, 
                    icon: "🍇", 
                    seedPrice: 120, 
                    growthTime: 240, 
                    minWeight: 0.1, 
                    maxWeight: 0.3, 
                    pricePerKg: 180, // Увеличенная цена
                    fruitCount: 12,
                    repeatGrowth: true,
                    availabilityChance: 0.5
                },
                watermelon: { 
                    name: { ru: "Арбуз", en: "Watermelon" }, 
                    icon: "🍉", 
                    seedPrice: 80, 
                    growthTime: 360, 
                    minWeight: 3, 
                    maxWeight: 10, 
                    pricePerKg: 37, // Увеличенная цена
                    fruitCount: 1,
                    repeatGrowth: false,
                    availabilityChance: 0.3
                },
                peach: { 
                    name: { ru: "Персик", en: "Peach" }, 
                    icon: "🍑", 
                    seedPrice: 70, 
                    growthTime: 280, 
                    minWeight: 0.3, 
                    maxWeight: 0.6, 
                    pricePerKg: 105, // Увеличенная цена
                    fruitCount: 3,
                    repeatGrowth: true,
                    availabilityChance: 0.6
                },
                coconut: { 
                    name: { ru: "Кокос", en: "Coconut" }, 
                    icon: "🥥", 
                    seedPrice: 200, 
                    growthTime: 600, 
                    minWeight: 1, 
                    maxWeight: 2.5, 
                    pricePerKg: 135, // Увеличенная цена
                    fruitCount: 1,
                    repeatGrowth: true,
                    availabilityChance: 0.2
                }
            },
            currentLanguage: 'ru',
            lastSave: Date.now(),
            shopTimer: 300, // 5 минут в секундах
            shopItems: {},
            nextShopUpdate: Date.now() + 300000 // 5 минут в миллисекундах
        };

        // DOM элементы
        const elements = {
            balance: document.getElementById('balance'),
            farmGrid: document.getElementById('farmGrid'),
            shopBtn: document.getElementById('shopBtn'),
            inventoryBtn: document.getElementById('inventoryBtn'),
            harvestAllBtn: document.getElementById('harvestAllBtn'),
            shopModal: document.getElementById('shopModal'),
            inventoryModal: document.getElementById('inventoryModal'),
            harvestModal: document.getElementById('harvestModal'),
            closeShopModal: document.getElementById('closeShopModal'),
            closeInventoryModal: document.getElementById('closeInventoryModal'),
            closeHarvestModal: document.getElementById('closeHarvestModal'),
            shopItems: document.getElementById('shopItems'),
            inventoryGrid: document.getElementById('inventoryGrid'),
            harvestSummary: document.getElementById('harvestSummary'),
            langButtons: document.querySelectorAll('.lang-btn'),
            shopTimer: document.getElementById('shopTimer'),
            subtitle: document.getElementById('subtitle'),
            harvestBtnText: document.getElementById('harvestBtnText'),
            farmTitle: document.getElementById('farmTitle'),
            shopTitle: document.getElementById('shopTitle'),
            inventoryTitle: document.getElementById('inventoryTitle'),
            harvestTitle: document.getElementById('harvestTitle')
        };

        // Инициализация игры
        function initGame() {
            loadGame();
            updateShopItems();
            renderFarm();
            renderShop();
            renderInventory();
            setupEventListeners();
            startGameLoop();
            startShopTimer();
            updateUI(); // Обновляем перевод при инициализации
        }

        // Настройка обработчиков событий
        function setupEventListeners() {
            elements.shopBtn.addEventListener('click', () => toggleModal(elements.shopModal));
            elements.inventoryBtn.addEventListener('click', () => toggleModal(elements.inventoryModal));
            elements.closeShopModal.addEventListener('click', () => toggleModal(elements.shopModal));
            elements.closeInventoryModal.addEventListener('click', () => toggleModal(elements.inventoryModal));
            elements.closeHarvestModal.addEventListener('click', () => toggleModal(elements.harvestModal));
            elements.harvestAllBtn.addEventListener('click', harvestAll);
            
            elements.langButtons.forEach(btn => {
                btn.addEventListener('click', () => switchLanguage(btn.dataset.lang));
            });
        }

        // Обновление магазина
        function updateShopItems() {
            // Если магазин уже обновлялся и есть сохраненные данные, используем их
            if (Object.keys(gameData.shopItems).length > 0) return;
            
            // Иначе генерируем новый магазин
            gameData.shopItems = {};
            Object.entries(gameData.plants).forEach(([plantId, plant]) => {
                if (Math.random() < plant.availabilityChance) {
                    gameData.shopItems[plantId] = {
                        quantity: Math.floor(Math.random() * 3) + 1, // 1-3 штуки
                        plant: plant
                    };
                }
            });
        }

        // Таймер магазина
        function startShopTimer() {
            // Рассчитываем оставшееся время до обновления магазина
            const timeLeft = Math.max(0, Math.floor((gameData.nextShopUpdate - Date.now()) / 1000));
            gameData.shopTimer = timeLeft;
            updateShopTimerDisplay();
            
            const timer = setInterval(() => {
                gameData.shopTimer--;
                updateShopTimerDisplay();
                
                if (gameData.shopTimer <= 0) {
                    updateShopItems();
                    renderShop();
                    gameData.nextShopUpdate = Date.now() + 300000; // +5 минут
                    gameData.shopTimer = 300;
                    showNotification(
                        gameData.currentLanguage === 'ru' 
                            ? '🛒 Магазин обновлен!' 
                            : '🛒 Shop updated!'
                    );
                }
            }, 1000);
        }
        
        function updateShopTimerDisplay() {
            const mins = Math.floor(gameData.shopTimer / 60);
            const secs = gameData.shopTimer % 60;
            elements.shopTimer.textContent = 
                gameData.currentLanguage === 'ru' 
                    ? `Магазин обновится через: ${mins}:${secs.toString().padStart(2, '0')}`
                    : `Shop updates in: ${mins}:${secs.toString().padStart(2, '0')}`;
        }

        // Переключение языка
        function switchLanguage(lang) {
            gameData.currentLanguage = lang;
            
            elements.langButtons.forEach(btn => {
                if (btn.dataset.lang === lang) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            
            updateUI();
        }

        // Обновление интерфейса
        function updateUI() {
            // Обновление текстов
            elements.subtitle.textContent = 
                gameData.currentLanguage === 'ru' 
                    ? 'Выращивай, собирай, продавай!' 
                    : 'Grow, harvest, sell!';
            
            elements.harvestBtnText.textContent = 
                gameData.currentLanguage === 'ru' 
                    ? 'Собрать всё' 
                    : 'Harvest All';
            
            elements.farmTitle.textContent = 
                gameData.currentLanguage === 'ru' 
                    ? 'Ваши грядки' 
                    : 'Your Farm';
            
            elements.shopTitle.textContent = 
                gameData.currentLanguage === 'ru' 
                    ? 'Магазин семян' 
                    : 'Seed Shop';
            
            elements.inventoryTitle.textContent = 
                gameData.currentLanguage === 'ru' 
                    ? 'Ваш инвентарь' 
                    : 'Your Inventory';
            
            elements.harvestTitle.textContent = 
                gameData.currentLanguage === 'ru' 
                    ? 'Урожай собран!' 
                    : 'Harvest Complete!';
            
            renderFarm();
            renderShop();
            renderInventory();
            updateShopTimerDisplay();
        }

        // Отображение грядок
        function renderFarm() {
            elements.farmGrid.innerHTML = '';
            
            gameData.plots.forEach((plot, index) => {
                const plotElement = document.createElement('div');
                plotElement.className = 'plot';
                
                if (!plot.plant) {
                    plotElement.classList.add('empty');
                    plotElement.innerHTML = `
                        <div class="plot-content">
                            <i class="fas fa-plus-circle plant-icon"></i>
                            <div>${gameData.currentLanguage === 'ru' ? 'Пусто' : 'Empty'}</div>
                        </div>
                    `;
                    plotElement.addEventListener('click', () => openPlantingDialog(index));
                } else {
                    const plant = gameData.plants[plot.plant];
                    const isReady = plot.progress >= plant.growthTime;
                    
                    if (isReady) {
                        plotElement.classList.add('ready');
                    } else {
                        plotElement.classList.add('growing');
                    }
                    
                    const progressPercent = Math.min(100, (plot.progress / plant.growthTime) * 100);
                    const timeLeft = Math.max(0, plant.growthTime - plot.progress);
                    
                    plotElement.innerHTML = `
                        <div class="plot-content">
                            <div class="plant-icon">${plant.icon}</div>
                            <div class="plant-name">${plant.name[gameData.currentLanguage]}</div>
                            ${!isReady ? `
                                <div class="progress-container">
                                    <div class="progress-bar" style="width: ${progressPercent}%"></div>
                                </div>
                                <div class="time-remaining">
                                    ${formatTime(timeLeft)}
                                </div>
                            ` : `
                                <div style="font-weight: 700; color: var(--success);">${gameData.currentLanguage === 'ru' ? 'Готово!' : 'Ready!'}</div>
                            `}
                        </div>
                    `;
                    
                    if (isReady) {
                        plotElement.addEventListener('click', () => harvestPlant(index));
                    }
                }
                
                elements.farmGrid.appendChild(plotElement);
            });
        }

        // Отображение магазина
        function renderShop() {
            elements.shopItems.innerHTML = '';
            
            Object.entries(gameData.shopItems).forEach(([plantId, shopItem]) => {
                const plant = shopItem.plant;
                const quantity = shopItem.quantity;
                
                const shopItemElement = document.createElement('div');
                shopItemElement.className = 'shop-item';
                
                shopItemElement.innerHTML = `
                    <div class="shop-item-header">
                        <div class="shop-item-icon">${plant.icon}</div>
                        <div class="shop-item-name">${plant.name[gameData.currentLanguage]}</div>
                    </div>
                    <div class="availability">${quantity} ${gameData.currentLanguage === 'ru' ? 'шт' : 'pcs'}</div>
                    <div class="shop-item-price">
                        <i class="fas fa-coins" style="color: var(--secondary);"></i>
                        ${plant.seedPrice} ${gameData.currentLanguage === 'ru' ? 'монет' : 'coins'}
                    </div>
                    <div class="shop-item-stats">
                        <div>${gameData.currentLanguage === 'ru' ? 'Время роста:' : 'Growth time:'}</div>
                        <div>${formatTime(plant.growthTime)}</div>
                        <div>${gameData.currentLanguage === 'ru' ? 'Цена за кг:' : 'Price per kg:'}</div>
                        <div>${plant.pricePerKg}</div>
                        <div>${gameData.currentLanguage === 'ru' ? 'Плодов:' : 'Fruits:'}</div>
                        <div>${plant.fruitCount}</div>
                    </div>
                    <button class="btn btn-primary buy-btn" data-plant="${plantId}">
                        <i class="fas fa-shopping-cart"></i>
                        ${gameData.currentLanguage === 'ru' ? 'Купить' : 'Buy'}
                    </button>
                `;
                
                elements.shopItems.appendChild(shopItemElement);
            });
            
            // Добавляем обработчики покупки
            document.querySelectorAll('.buy-btn').forEach(btn => {
                btn.addEventListener('click', () => buySeeds(btn.dataset.plant));
            });
            
            // Если магазин пуст
            if (Object.keys(gameData.shopItems).length === 0) {
                elements.shopItems.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 30px 0; color: var(--text-secondary);">
                        <i class="fas fa-store-slash" style="font-size: 3rem; margin-bottom: 15px;"></i>
                        <h3>${gameData.currentLanguage === 'ru' ? 'Магазин пуст' : 'Shop is empty'}</h3>
                        <p>${gameData.currentLanguage === 'ru' ? 'Ждите обновления магазина' : 'Waiting for shop update'}</p>
                    </div>
                `;
            }
        }

        // Отображение инвентаря
        function renderInventory() {
            elements.inventoryGrid.innerHTML = '';
            
            // Семена
            Object.entries(gameData.inventory.seeds).forEach(([plantId, quantity]) => {
                if (quantity > 0) {
                    const plant = gameData.plants[plantId];
                    const inventoryItem = document.createElement('div');
                    inventoryItem.className = 'inventory-item';
                    
                    inventoryItem.innerHTML = `
                        <div class="inventory-item-icon">${plant.icon}</div>
                        <div class="inventory-item-name">${plant.name[gameData.currentLanguage]}</div>
                        <div class="inventory-item-quantity">${quantity}</div>
                        <div class="inventory-actions">
                            <button class="btn btn-primary action-btn" data-action="plant" data-plant="${plantId}">
                                ${gameData.currentLanguage === 'ru' ? 'Сажать' : 'Plant'}
                            </button>
                        </div>
                    `;
                    
                    elements.inventoryGrid.appendChild(inventoryItem);
                }
            });
            
            // Растения
            Object.entries(gameData.inventory.plants).forEach(([plantId, items]) => {
                if (items.length > 0) {
                    const plant = gameData.plants[plantId];
                    const totalQuantity = items.length;
                    
                    const inventoryItem = document.createElement('div');
                    inventoryItem.className = 'inventory-item';
                    
                    // Формируем список плодов
                    let fruitsHTML = '';
                    items.forEach((fruit, index) => {
                        const value = (fruit * plant.pricePerKg).toFixed(1);
                        fruitsHTML += `
                            <div class="fruit-item">
                                <span>${gameData.currentLanguage === 'ru' ? 'Плод' : 'Fruit'} ${index+1}:</span>
                                <span class="fruit-weight">${fruit} кг</span>
                                <span>(${value} <i class="fas fa-coins" style="color: var(--secondary);"></i>)</span>
                            </div>
                        `;
                    });
                    
                    inventoryItem.innerHTML = `
                        <div class="inventory-item-icon">${plant.icon}</div>
                        <div class="inventory-item-name">${plant.name[gameData.currentLanguage]}</div>
                        <div class="inventory-item-quantity">${totalQuantity}</div>
                        <div class="inventory-fruits">
                            ${fruitsHTML}
                        </div>
                        <div class="inventory-actions">
                            <button class="btn btn-primary action-btn" data-action="sell-one" data-plant="${plantId}">
                                ${gameData.currentLanguage === 'ru' ? 'Продать 1' : 'Sell 1'}
                            </button>
                            <button class="btn btn-secondary action-btn" data-action="sell-all" data-plant="${plantId}">
                                ${gameData.currentLanguage === 'ru' ? 'Все' : 'All'}
                            </button>
                        </div>
                    `;
                    
                    elements.inventoryGrid.appendChild(inventoryItem);
                }
            });
            
            // Если инвентарь пуст
            if (elements.inventoryGrid.children.length === 0) {
                elements.inventoryGrid.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 30px 0; color: var(--text-secondary);">
                        <i class="fas fa-box-open" style="font-size: 3rem; margin-bottom: 15px;"></i>
                        <h3>${gameData.currentLanguage === 'ru' ? 'Инвентарь пуст' : 'Inventory is empty'}</h3>
                        <p>${gameData.currentLanguage === 'ru' ? 'Купите семена в магазине' : 'Buy seeds in the shop'}</p>
                    </div>
                `;
            } else {
                // Добавляем обработчики действий
                document.querySelectorAll('.action-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const action = btn.dataset.action;
                        const plantId = btn.dataset.plant;
                        
                        if (action === 'plant') {
                            openPlantingDialogWithPlant(plantId);
                        } else if (action === 'sell-one') {
                            sellPlant(plantId, 1);
                        } else if (action === 'sell-all') {
                            sellPlant(plantId, 'all');
                        }
                    });
                });
            }
        }

        // Покупка семян
        function buySeeds(plantId) {
            const shopItem = gameData.shopItems[plantId];
            if (!shopItem || shopItem.quantity <= 0) {
                showNotification(
                    gameData.currentLanguage === 'ru' 
                        ? 'Эти семена закончились!' 
                        : 'These seeds are sold out!',
                    'error'
                );
                return;
            }
            
            const plant = shopItem.plant;
            
            if (gameData.balance >= plant.seedPrice) {
                gameData.balance -= plant.seedPrice;
                
                // Уменьшаем количество в магазине
                shopItem.quantity--;
                
                // Добавляем в инвентарь
                if (!gameData.inventory.seeds[plantId]) {
                    gameData.inventory.seeds[plantId] = 0;
                }
                
                gameData.inventory.seeds[plantId]++;
                updateBalance();
                renderShop();
                renderInventory();
                showNotification(
                    gameData.currentLanguage === 'ru' 
                        ? `Куплены семена: ${plant.name.ru}` 
                        : `Bought seeds: ${plant.name.en}`
                );
                
                // Анимация
                createCollectAnimation('💰', 'var(--secondary)');
            } else {
                showNotification(
                    gameData.currentLanguage === 'ru' 
                        ? 'Недостаточно монет!' 
                        : 'Not enough coins!',
                    'error'
                );
            }
        }

        // Открытие диалога посадки
        function openPlantingDialog(plotIndex) {
            // Если у игрока есть семена, открыть выбор семян
            if (Object.values(gameData.inventory.seeds).some(qty => qty > 0)) {
                toggleModal(elements.inventoryModal);
            } else {
                showNotification(
                    gameData.currentLanguage === 'ru' 
                        ? 'Купите семена в магазине!' 
                        : 'Buy seeds in the shop!',
                    'error'
                );
            }
        }

        // Открытие диалога посадки с определенным растением
        function openPlantingDialogWithPlant(plantId) {
            toggleModal(elements.inventoryModal);
            
            // Найти свободную грядку
            const freePlotIndex = gameData.plots.findIndex(plot => !plot.plant);
            
            if (freePlotIndex !== -1) {
                plantSeed(freePlotIndex, plantId);
            } else {
                showNotification(
                    gameData.currentLanguage === 'ru' 
                        ? 'Нет свободных грядок!' 
                        : 'No free plots!',
                    'error'
                );
            }
        }

        // Посадка семян
        function plantSeed(plotIndex, plantId) {
            if (gameData.inventory.seeds[plantId] > 0) {
                gameData.inventory.seeds[plantId]--;
                
                gameData.plots[plotIndex] = {
                    plant: plantId,
                    progress: 0,
                    fruits: []
                };
                
                renderFarm();
                renderInventory();
                showNotification(
                    gameData.currentLanguage === 'ru' 
                        ? `Посажено: ${gameData.plants[plantId].name.ru}` 
                        : `Planted: ${gameData.plants[plantId].name.en}`
                );
                
                // Анимация
                createCollectAnimation('🌱', 'var(--primary)');
            }
        }

        // Сбор урожая с одной грядки
        function harvestPlant(plotIndex) {
            const plot = gameData.plots[plotIndex];
            const plant = gameData.plants[plot.plant];
            
            // Генерируем плоды
            const fruits = [];
            for (let i = 0; i < plant.fruitCount; i++) {
                const weight = (Math.random() * (plant.maxWeight - plant.minWeight) + plant.minWeight).toFixed(2);
                fruits.push(weight);
            }
            
            // Добавляем в инвентарь
            if (!gameData.inventory.plants[plot.plant]) {
                gameData.inventory.plants[plot.plant] = [];
            }
            
            gameData.inventory.plants[plot.plant] = gameData.inventory.plants[plot.plant].concat(fruits);
            
            // Показываем информацию о собранном урожае
            let message = gameData.currentLanguage === 'ru' 
                ? `Собрано: ${plant.name.ru}<br>`
                : `Harvested: ${plant.name.en}<br>`;
            
            fruits.forEach((weight, i) => {
                message += `🍎 ${gameData.currentLanguage === 'ru' ? 'Плод' : 'Fruit'} ${i+1}: ${weight} кг<br>`;
            });
            
            showNotification(message);
            
            // Обработка растения после сбора
            if (plant.repeatGrowth) {
                // Для многолетних растений - сброс прогресса
                gameData.plots[plotIndex].progress = 0;
                gameData.plots[plotIndex].fruits = [];
            } else {
                // Для однолетних - освобождаем грядку
                gameData.plots[plotIndex] = { plant: null, progress: 0, fruits: [] };
            }
            
            renderFarm();
            renderInventory();
            
            // Анимация
            createCollectAnimation(plant.icon, '#FF9800');
        }

        // Сбор всего урожая
        function harvestAll() {
            let harvested = false;
            const harvestSummary = {};
            
            gameData.plots.forEach((plot, index) => {
                if (plot.plant && plot.progress >= gameData.plants[plot.plant].growthTime) {
                    const plant = gameData.plants[plot.plant];
                    
                    // Генерируем плоды
                    const fruits = [];
                    for (let i = 0; i < plant.fruitCount; i++) {
                        const weight = (Math.random() * (plant.maxWeight - plant.minWeight) + plant.minWeight).toFixed(2);
                        fruits.push(weight);
                    }
                    
                    // Добавляем в сводку
                    if (!harvestSummary[plot.plant]) {
                        harvestSummary[plot.plant] = {
                            name: plant.name[gameData.currentLanguage],
                            icon: plant.icon,
                            count: plant.fruitCount,
                            fruits: []
                        };
                    }
                    harvestSummary[plot.plant].fruits = harvestSummary[plot.plant].fruits.concat(fruits);
                    
                    // Добавляем в инвентарь
                    if (!gameData.inventory.plants[plot.plant]) {
                        gameData.inventory.plants[plot.plant] = [];
                    }
                    gameData.inventory.plants[plot.plant] = gameData.inventory.plants[plot.plant].concat(fruits);
                    
                    // Обработка растения после сбора
                    if (plant.repeatGrowth) {
                        gameData.plots[index].progress = 0;
                        gameData.plots[index].fruits = [];
                    } else {
                        gameData.plots[index] = { plant: null, progress: 0, fruits: [] };
                    }
                    
                    harvested = true;
                    
                    // Анимация
                    createCollectAnimation(plant.icon, '#FF9800');
                }
            });
            
            if (harvested) {
                renderFarm();
                renderInventory();
                showHarvestSummary(harvestSummary);
            } else {
                showNotification(
                    gameData.currentLanguage === 'ru' 
                        ? 'Нет готовых к сбору растений!' 
                        : 'No plants ready for harvest!',
                    'warning'
                );
            }
        }
        
        // Показать сводку по собранному урожаю
        function showHarvestSummary(summary) {
            let html = `
                <div class="harvest-title">
                    <i class="fas fa-basket-shopping"></i>
                    ${gameData.currentLanguage === 'ru' ? 'Вы собрали:' : 'You harvested:'}
                </div>
            `;
            
            Object.values(summary).forEach(item => {
                html += `
                    <div class="harvest-item">
                        <div><span style="font-size: 1.2em;">${item.icon}</span> ${item.name}</div>
                        <div>${item.fruits.length} ${gameData.currentLanguage === 'ru' ? 'плодов' : 'fruits'}</div>
                    </div>
                `;
            });
            
            elements.harvestSummary.innerHTML = html;
            toggleModal(elements.harvestModal);
        }

        // Продажа растений
        function sellPlant(plantId, amount) {
            const plants = gameData.inventory.plants[plantId];
            if (!plants || plants.length === 0) return;
            
            const plant = gameData.plants[plantId];
            let totalIncome = 0;
            let itemsSold = 0;
            
            if (amount === 'all') {
                // Продаем все
                plants.forEach(weight => {
                    totalIncome += weight * plant.pricePerKg;
                });
                itemsSold = plants.length;
                gameData.inventory.plants[plantId] = [];
            } else {
                // Продаем указанное количество
                const toSell = Math.min(amount, plants.length);
                for (let i = 0; i < toSell; i++) {
                    totalIncome += plants[i] * plant.pricePerKg;
                    itemsSold++;
                }
                gameData.inventory.plants[plantId] = plants.slice(itemsSold);
            }
            
            totalIncome = Math.round(totalIncome);
            gameData.balance += totalIncome;
            
            updateBalance();
            renderInventory();
            showNotification(
                gameData.currentLanguage === 'ru' 
                    ? `Продано ${itemsSold} ${plant.name.ru} за ${totalIncome} монет` 
                    : `Sold ${itemsSold} ${plant.name.en} for ${totalIncome} coins`
            );
            
            // Анимация
            createCollectAnimation('💰', 'var(--secondary)');
        }

        // Обновление баланса
        function updateBalance() {
            elements.balance.textContent = gameData.balance;
        }

        // Форматирование времени
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        // Показ уведомления
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Переключение модального окна
        function toggleModal(modal) {
            modal.classList.toggle('active');
        }

        // Создание анимации сбора
        function createCollectAnimation(icon, color) {
            const anim = document.createElement('div');
            anim.className = 'collect-animation';
            anim.innerHTML = icon;
            anim.style.color = color;
            anim.style.position = 'fixed';
            anim.style.left = `${Math.random() * 80 + 10}%`;
            anim.style.top = '80%';
            anim.style.fontSize = '2.5rem';
            anim.style.zIndex = '1000';
            document.body.appendChild(anim);
            
            setTimeout(() => {
                anim.remove();
            }, 1000);
        }

        // Игровой цикл
        function startGameLoop() {
            setInterval(() => {
                // Обновляем прогресс роста растений
                gameData.plots.forEach(plot => {
                    if (plot.plant && plot.progress < gameData.plants[plot.plant].growthTime) {
                        plot.progress += 1;
                    }
                });
                
                renderFarm();
                
                // Автосохранение каждые 10 секунд
                if (Date.now() - gameData.lastSave > 10000) {
                    saveGame();
                    gameData.lastSave = Date.now();
                }
            }, 1000);
        }

        // Сохранение игры
        function saveGame() {
            // Сохраняем состояние магазина и время следующего обновления
            gameData.nextShopUpdate = Date.now() + gameData.shopTimer * 1000;
            localStorage.setItem('gagbot_save', JSON.stringify(gameData));
        }

        // Загрузка игры
        function loadGame() {
            const save = localStorage.getItem('gagbot_save');
            if (save) {
                const parsed = JSON.parse(save);
                Object.assign(gameData, parsed);
                
                // Рассчитываем оставшееся время для таймера магазина
                if (gameData.nextShopUpdate) {
                    const timeLeft = Math.max(0, Math.floor((gameData.nextShopUpdate - Date.now()) / 1000));
                    gameData.shopTimer = timeLeft;
                }
                
                updateBalance();
            }
        }

        // Запуск игры при загрузке страницы
        window.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>
